int pinV = A1;  //Analog pin measuring voltage
int pinA = A0;  //Analog pin measuring current
int pinGate = 3; // digital pin controlling the gate voltage

//int period = 256; //Period time for a square sequence
int duty[256]; //Array filled with values for how long the square part will be in the pulse.
int settlingTime = 5000; //(in us)
int measurmentPaus = 1000; //(in us)
int tracker = 0; //Keeping track of the current measurment series
int measuredV[256]; //Array storing the measured voltages for a series
int measuredA[256]; //Array storing the measured current for a series


void setup() {
  Serial.begin(9600);

  for (int j = 0; j < 256; j++) {
    duty[j] = j;
  }
}
void loop() {
  Serial.print("Measurment series ");
  Serial.print(tracker);
  Serial.println(" initiated");

  for (int j = 0; j < 256; j++) {
    analogWrite(pinGate, duty[j]); //Creates square waves with the current duty
    delay(settlingTime); //Circuit is allowed to enter steadystate
    measuredV[j] = analogRead(pinV); //Measures V
    measuredA[j] = analogRead(pinA); //Measures A
    Serial.print("The volt for duty ");
    Serial.print(duty[j]);
    Serial.println(" is:");
    Serial.println(measuredV[j]);
    Serial.println("And the current is:");
    Serial.println(measuredA[j]);
  }
  //exports measuredV and measuredA with tracker to Arduino Mega
  tracker++;
  delay(measurmentPaus); //Delays the next measurment series so not to flood the receiver
}

